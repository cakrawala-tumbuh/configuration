name: mv_analisis_kinerja_guru
domain: sdm
description: Analisis kinerja guru berdasarkan kehadiran, evaluasi, dan hasil pembelajaran siswa, termasuk indeks komposit performance.
purpose:
  - Memberikan gambaran menyeluruh kinerja guru per periode
  - Menjadi dasar evaluasi, pelatihan, dan pemberian insentif
  - Memudahkan analisis detail maupun ringkasan performance
sources:
  guru:
    url: struktur_data/guru.yaml
  absensi_guru:
    url: struktur_data/absensi_guru.yaml
  evaluasi_guru:
    url: struktur_data/evaluasi_guru.yaml
  nilai_siswa:
    url: struktur_data/nilai_siswa.yaml
primary_key:
  - guru_id
  - periode
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode evaluasi (bulanan).
    source:
      ref: absensi_guru
      column: tanggal
    transform: "date_trunc('month', absensi_guru.tanggal)::date"
    example: 2025-07-01

  - name: guru_id
    type: uuid
    nullable: false
    description: Identitas unik guru.
    source:
      ref: guru
      column: id
    example: "b123e456-78d9-42b3-a456-426614174000"

  - name: nama_guru
    type: text
    nullable: false
    description: Nama guru.
    source:
      ref: guru
      column: nama
    example: "Andi Wijaya"

  - name: tingkat_kehadiran
    type: numeric(5,2)
    nullable: true
    description: Persentase kehadiran guru dalam periode (%).
    source:
      ref: absensi_guru
      column: status
    transform: "round((count(*) filter (where absensi_guru.status='hadir')::numeric / nullif(count(*),0)) * 100, 2)"
    example: 96.50

  - name: skor_evaluasi
    type: numeric(5,2)
    nullable: true
    description: Nilai rata-rata hasil evaluasi guru dari supervisor.
    source:
      ref: evaluasi_guru
      column: skor
    transform: "avg(evaluasi_guru.skor)"
    example: 4.35

  - name: rerata_nilai_siswa
    type: numeric(5,2)
    nullable: true
    description: Nilai rata-rata siswa yang diajar oleh guru.
    source:
      ref: nilai_siswa
      column: nilai
    transform: "avg(nilai_siswa.nilai)"
    example: 82.45

  - name: indeks_performance
    type: numeric(5,2)
    nullable: true
    description: Indeks komposit kinerja guru (gabungan kehadiran, evaluasi, hasil siswa).
    source:
      ref: evaluasi_guru
      column: skor
    transform: "(0.4*avg(evaluasi_guru.skor)) + (0.3*round((count(*) filter (where absensi_guru.status='hadir')::numeric / nullif(count(*),0)) * 100, 2)/20) + (0.3*avg(nilai_siswa.nilai)/25)"
    example: 4.12

dependencies:
  base_entities:
    - guru
    - absensi_guru
    - evaluasi_guru
    - nilai_siswa
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 6 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Absensi guru baru
    - Evaluasi guru baru
    - Nilai siswa baru

indexes:
  - name: mv_analisis_kinerja_guru_pk
    type: unique
    columns:
      - periode
      - guru_id

retention:
  keep_history_months: 36
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - hr_reviewer
  pii:
    contains_pii: true
    columns:
      - nama_guru

notes:
  - Indeks performance dapat dikalibrasi sesuai bobot kebijakan sekolah.
  - MV ini menjadi gabungan analisis detail dan ringkasan kinerja.
