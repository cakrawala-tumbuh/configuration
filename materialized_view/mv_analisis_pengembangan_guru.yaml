name: mv_analisis_pengembangan_guru
domain: sdm
description: Ringkasan partisipasi dan capaian guru dalam program pengembangan kompetensi.
purpose:
  - Menyediakan data agregat pelatihan guru per periode
  - Memantau keterlibatan guru dalam program pengembangan kompetensi
  - Mengukur capaian hasil pelatihan
sources:
  guru:
    url: struktur_data/guru.yaml
  pelatihan_guru:
    url: struktur_data/pelatihan_guru.yaml
  hasil_pelatihan:
    url: struktur_data/hasil_pelatihan.yaml
primary_key:
  - periode
  - guru_id
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode agregasi (bulanan).
    source:
      ref: pelatihan_guru
      column: tanggal
    transform: "date_trunc('month', pelatihan_guru.tanggal)::date"
    example: 2025-07-01

  - name: guru_id
    type: integer
    nullable: false
    description: ID unik guru.
    source:
      ref: guru
      column: id
    example: 201

  - name: nama_guru
    type: text
    nullable: false
    description: Nama lengkap guru.
    source:
      ref: guru
      column: nama
    example: "Siti Aminah"

  - name: jumlah_pelatihan
    type: integer
    nullable: true
    description: Jumlah pelatihan yang diikuti guru dalam periode tersebut.
    source:
      ref: pelatihan_guru
      column: id
    transform: "count(distinct pelatihan_guru.id)"
    example: 3

  - name: rata_rata_hasil_pelatihan
    type: numeric(5,2)
    nullable: true
    description: Nilai rata-rata hasil pelatihan guru.
    source:
      ref: hasil_pelatihan
      column: nilai
    transform: "avg(hasil_pelatihan.nilai)"
    example: 87.50

  - name: status_pengembangan
    type: text
    nullable: true
    description: Status capaian pengembangan (aktif/pasif/unggul).
    source:
      ref: hasil_pelatihan
      column: nilai
    transform: "case when avg(hasil_pelatihan.nilai) >= 85 then 'unggul' when count(pelatihan_guru.id) > 0 then 'aktif' else 'pasif' end"
    example: "unggul"

dependencies:
  base_entities:
    - guru
    - pelatihan_guru
    - hasil_pelatihan
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 4 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Update data pelatihan guru
    - Update hasil pelatihan guru

indexes:
  - name: mv_analisis_pengembangan_guru_pk
    type: unique
    columns:
      - periode
      - guru_id

retention:
  keep_history_months: 84
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - sdm_reviewer
  pii:
    contains_pii: true
    columns:
      - guru_id
      - nama_guru

notes:
  - Status pengembangan dihitung berdasarkan kombinasi jumlah pelatihan dan nilai hasil pelatihan.
  - Guru tanpa data pelatihan akan diberi status "pasif".
