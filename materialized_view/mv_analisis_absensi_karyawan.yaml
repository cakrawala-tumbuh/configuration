name: mv_analisis_absensi_karyawan
domain: sdm
description: Ringkasan tingkat kehadiran karyawan untuk memantau disiplin dan produktivitas.
purpose:
  - Mengukur persentase kehadiran karyawan per periode
  - Mengidentifikasi pola absensi yang bermasalah
  - Mendukung evaluasi kedisiplinan karyawan
sources:
  karyawan:
    url: struktur_data/karyawan.yaml
  absensi:
    url: struktur_data/absensi.yaml
primary_key:
  - periode
  - karyawan_id
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode absensi (bulanan).
    source:
      ref: absensi
      column: tanggal
    transform: "date_trunc('month', absensi.tanggal)::date"
    example: 2025-07-01

  - name: karyawan_id
    type: integer
    nullable: false
    description: ID unik karyawan.
    source:
      ref: karyawan
      column: id
    example: 302

  - name: nama_karyawan
    type: text
    nullable: false
    description: Nama lengkap karyawan.
    source:
      ref: karyawan
      column: nama
    example: "Budi Santoso"

  - name: jumlah_hadir
    type: integer
    nullable: true
    description: Jumlah hari hadir dalam periode.
    source:
      ref: absensi
      column: status
    transform: "count(*) filter (where absensi.status = 'hadir')"
    example: 20

  - name: jumlah_alpa
    type: integer
    nullable: true
    description: Jumlah hari tidak hadir tanpa keterangan dalam periode.
    source:
      ref: absensi
      column: status
    transform: "count(*) filter (where absensi.status = 'alpa')"
    example: 2

  - name: jumlah_izin
    type: integer
    nullable: true
    description: Jumlah hari izin dalam periode.
    source:
      ref: absensi
      column: status
    transform: "count(*) filter (where absensi.status = 'izin')"
    example: 1

  - name: jumlah_sakit
    type: integer
    nullable: true
    description: Jumlah hari sakit dalam periode.
    source:
      ref: absensi
      column: status
    transform: "count(*) filter (where absensi.status = 'sakit')"
    example: 2

  - name: persentase_kehadiran
    type: numeric(5,2)
    nullable: true
    description: Persentase kehadiran karyawan dalam periode.
    source:
      ref: absensi
      column: status
    transform: "(count(*) filter (where absensi.status = 'hadir')::decimal / count(*)::decimal) * 100"
    example: 86.96

dependencies:
  base_entities:
    - karyawan
    - absensi
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 1 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Input absensi harian baru

indexes:
  - name: mv_analisis_absensi_karyawan_pk
    type: unique
    columns:
      - periode
      - karyawan_id

retention:
  keep_history_months: 36
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - sdm_reviewer
  pii:
    contains_pii: true
    columns:
      - karyawan_id
      - nama_karyawan

notes:
  - Perhitungan persentase kehadiran menggunakan pembagi jumlah hari kerja yang tercatat.
  - Dapat digunakan untuk memantau tren ketidakhadiran.
