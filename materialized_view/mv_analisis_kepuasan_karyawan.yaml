name: mv_analisis_kepuasan_karyawan
domain: sdm
description: Ringkasan hasil survei kepuasan karyawan untuk memantau tingkat kepuasan kerja.
purpose:
  - Mengukur tingkat kepuasan karyawan per periode
  - Mengidentifikasi aspek kerja yang perlu perbaikan
  - Mendukung laporan HR terkait kesejahteraan karyawan
sources:
  karyawan:
    url: struktur_data/karyawan.yaml
  survei_kepuasan:
    url: struktur_data/survei_kepuasan.yaml
primary_key:
  - periode
  - karyawan_id
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode survei (bulanan/semesteran).
    source:
      ref: survei_kepuasan
      column: tanggal
    transform: "date_trunc('month', survei_kepuasan.tanggal)::date"
    example: 2025-07-01

  - name: karyawan_id
    type: integer
    nullable: false
    description: ID unik karyawan.
    source:
      ref: karyawan
      column: id
    example: 301

  - name: nama_karyawan
    type: text
    nullable: false
    description: Nama lengkap karyawan.
    source:
      ref: karyawan
      column: nama
    example: "Andi Pratama"

  - name: skor_kepuasan
    type: numeric(5,2)
    nullable: true
    description: Skor rata-rata kepuasan karyawan berdasarkan survei.
    source:
      ref: survei_kepuasan
      column: skor
    transform: "avg(survei_kepuasan.skor)"
    example: 4.25

  - name: kategori_kepuasan
    type: text
    nullable: true
    description: Kategori kepuasan berdasarkan skor (tinggi/sedang/rendah).
    source:
      ref: survei_kepuasan
      column: skor
    transform: "case when avg(survei_kepuasan.skor) >= 4 then 'tinggi' when avg(survei_kepuasan.skor) >= 3 then 'sedang' else 'rendah' end"
    example: "tinggi"

  - name: komentar_utama
    type: text
    nullable: true
    description: Ringkasan komentar terbanyak yang muncul pada survei.
    source:
      ref: survei_kepuasan
      column: komentar
    transform: "mode() within group (order by survei_kepuasan.komentar)"
    example: "Butuh peningkatan fasilitas kerja"

dependencies:
  base_entities:
    - karyawan
    - survei_kepuasan
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 2 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Input hasil survei kepuasan baru

indexes:
  - name: mv_analisis_kepuasan_karyawan_pk
    type: unique
    columns:
      - periode
      - karyawan_id

retention:
  keep_history_months: 36
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - sdm_reviewer
  pii:
    contains_pii: true
    columns:
      - karyawan_id
      - nama_karyawan

notes:
  - Survei kepuasan dapat dilakukan bulanan atau semesteran tergantung kebijakan HR.
  - Analisis fokus pada skor rata-rata dan tren kepuasan.
