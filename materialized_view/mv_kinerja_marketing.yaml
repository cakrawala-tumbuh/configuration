name: mv_kinerja_marketing
domain: marketing
description: Ringkasan efektivitas aktivitas marketing dalam menghasilkan prospek dan siswa baru.
purpose:
  - Mengukur jumlah prospek yang dihasilkan dari aktivitas marketing
  - Mengukur tingkat konversi prospek menjadi siswa
  - Membandingkan efektivitas antar channel marketing
sources:
  aktivitas_marketing:
    url: struktur_data/aktivitas_marketing.yaml
  prospek:
    url: struktur_data/prospek.yaml
  siswa:
    url: struktur_data/siswa.yaml
primary_key:
  - periode
  - channel_marketing
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode analisis (bulanan).
    source:
      ref: aktivitas_marketing
      column: tanggal
    transform: "date_trunc('month', aktivitas_marketing.tanggal)::date"
    example: 2025-07-01

  - name: channel_marketing
    type: text
    nullable: false
    description: Channel marketing yang digunakan (misalnya brosur, media sosial, referensi).
    source:
      ref: aktivitas_marketing
      column: channel
    example: "Media Sosial"

  - name: jumlah_aktivitas
    type: integer
    nullable: true
    description: Jumlah aktivitas marketing yang dilakukan dalam periode.
    source:
      ref: aktivitas_marketing
      column: id
    transform: "count(id)"
    example: 12

  - name: jumlah_prospek
    type: integer
    nullable: true
    description: Jumlah prospek yang diperoleh dari aktivitas marketing dalam periode.
    source:
      ref: prospek
      column: id
    transform: "count(distinct prospek.id)"
    example: 85

  - name: jumlah_siswa_baru
    type: integer
    nullable: true
    description: Jumlah siswa baru yang berasal dari prospek dalam periode.
    source:
      ref: siswa
      column: id
    transform: "count(distinct siswa.id)"
    example: 32

  - name: tingkat_konversi
    type: numeric(5,2)
    nullable: true
    description: Rasio konversi prospek menjadi siswa baru (%).
    source:
      ref: prospek
      column: id
    transform: "round((count(distinct siswa.id)::numeric / nullif(count(distinct prospek.id),0)) * 100, 2)"
    example: 37.65

dependencies:
  base_entities:
    - aktivitas_marketing
    - prospek
    - siswa
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 5 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Input aktivitas marketing baru
    - Input prospek baru
    - Input siswa baru

indexes:
  - name: mv_kinerja_marketing_pk
    type: unique
    columns:
      - periode
      - channel_marketing

retention:
  keep_history_months: 36
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - marketing_reviewer
  pii:
    contains_pii: false
    columns: []

notes:
  - MV ini membantu mengukur ROI dan efektivitas tiap channel marketing.
  - Dapat digunakan sebagai dasar evaluasi strategi marketing.
