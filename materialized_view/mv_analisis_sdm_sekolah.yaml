name: mv_analisis_sdm_sekolah
domain: sdm
description: Ringkasan distribusi dan kinerja SDM sekolah berdasarkan data guru, pegawai, serta indikator kinerja.
purpose:
  - Menyediakan gambaran agregat tenaga kerja sekolah
  - Analisis rasio guru terhadap siswa
  - Identifikasi distribusi pegawai berdasarkan unit kerja
sources:
  guru:
    url: struktur_data/guru.yaml
  pegawai:
    url: struktur_data/pegawai.yaml
  kinerja_guru:
    url: struktur_data/kinerja_guru.yaml
primary_key:
  - periode
columns:
  - name: periode
    type: date
    nullable: false
    description: Periode agregasi (bulanan).
    source:
      ref: guru
      column: tgl_mulai
    transform: "date_trunc('month', guru.tgl_mulai)::date"
    example: 2025-07-01

  - name: jumlah_guru
    type: integer
    nullable: true
    description: Jumlah guru aktif di periode tersebut.
    source:
      ref: guru
      column: id
    transform: "count(distinct guru.id)"
    example: 120

  - name: jumlah_pegawai
    type: integer
    nullable: true
    description: Jumlah pegawai non-guru aktif di periode tersebut.
    source:
      ref: pegawai
      column: id
    transform: "count(distinct pegawai.id)"
    example: 45

  - name: rasio_guru_siswa
    type: numeric(6,2)
    nullable: true
    description: Rasio jumlah guru terhadap jumlah siswa.
    source:
      ref: guru
      column: id
    transform: "count(distinct guru.id)::decimal / nullif((select count(distinct siswa.id) from siswa),0)"
    example: 1.00

  - name: rata_rata_nilai_kinerja
    type: numeric(5,2)
    nullable: true
    description: Nilai rata-rata kinerja guru di periode tersebut.
    source:
      ref: kinerja_guru
      column: nilai
    transform: "avg(kinerja_guru.nilai)"
    example: 85.50

dependencies:
  base_entities:
    - guru
    - pegawai
    - kinerja_guru
  views: []
  materialized_views: []

refresh_policy:
  strategy: scheduled
  schedule_cron: "0 5 * * *"
  with_data_on_create: true
  concurrently_on_refresh: true
  invalidate:
    - Update data guru
    - Update data pegawai
    - Update penilaian kinerja guru

indexes:
  - name: mv_analisis_sdm_sekolah_pk
    type: unique
    columns:
      - periode

retention:
  keep_history_months: 120
  prune_policy: hapus data > keep_history_months

security:
  grant_read_to_roles:
    - bi_analyst
    - sdm_reviewer
  pii:
    contains_pii: true
    columns:
      - jumlah_guru
      - jumlah_pegawai

notes:
  - Rasio guru terhadap siswa dihitung dari total siswa di seluruh sekolah.
  - Hanya guru dan pegawai dengan status aktif yang dihitung.
